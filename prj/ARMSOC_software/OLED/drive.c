#include "drive.h"



const unsigned char  Chinese_text_16x16[] = 
{
	"室内外温度差较大注意防暑保暖适宜"

};

const unsigned char  Chinese_code_16x16[] = 
{

		0x10,0x0C,0x24,0x24,0xA4,0x64,0x25,0x26,0x24,0x24,0xA4,0x24,0x24,0x14,0x0C,0x00,
		0x40,0x40,0x48,0x49,0x49,0x49,0x49,0x7F,0x49,0x49,0x49,0x4B,0x48,0x40,0x40,0x00,/*"室",0*/
	
		0x00,0xF8,0x08,0x08,0x08,0x08,0x88,0x7F,0x88,0x08,0x08,0x08,0x08,0xF8,0x00,0x00,
		0x00,0xFF,0x00,0x08,0x04,0x02,0x01,0x00,0x00,0x01,0x02,0x4C,0x80,0x7F,0x00,0x00,/*"内",1*/
	
		0x00,0xC0,0x30,0x1F,0x10,0x10,0xF0,0x00,0x00,0xFF,0x20,0x40,0x80,0x00,0x00,0x00,
		0x81,0x40,0x21,0x12,0x0C,0x03,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x03,0x00,0x00,/*"外",2*/
	
		0x10,0x60,0x02,0x8C,0x00,0x00,0xFE,0x92,0x92,0x92,0x92,0x92,0xFE,0x00,0x00,0x00,
		0x04,0x04,0x7E,0x01,0x40,0x7E,0x42,0x42,0x7E,0x42,0x7E,0x42,0x42,0x7E,0x40,0x00,/*"温",3*/
	
		0x00,0x00,0xFC,0x24,0x24,0x24,0xFC,0x25,0x26,0x24,0xFC,0x24,0x24,0x24,0x04,0x00,
		0x40,0x30,0x8F,0x80,0x84,0x4C,0x55,0x25,0x25,0x25,0x55,0x4C,0x80,0x80,0x80,0x00,/*"度",4*/
	
		0x00,0x04,0x24,0x24,0x25,0x26,0xE4,0x3C,0x24,0x26,0x25,0x24,0x24,0x04,0x00,0x00,
		0x41,0x21,0x11,0x89,0x85,0x8B,0x89,0x89,0xF9,0x89,0x89,0x89,0x89,0x81,0x01,0x00,/*"差",5*/
	
		0xC8,0xB8,0x8F,0xE8,0x88,0x88,0x80,0x48,0x28,0x09,0x0E,0x08,0x28,0x48,0x88,0x00,
		0x08,0x18,0x08,0xFF,0x04,0x04,0x80,0x80,0x43,0x2C,0x10,0x2C,0x43,0x80,0x80,0x00,/*"较",6*/
	
		0x20,0x20,0x20,0x20,0x20,0x20,0x20,0xFF,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x00,
		0x80,0x80,0x40,0x20,0x10,0x0C,0x03,0x00,0x03,0x0C,0x10,0x20,0x40,0x80,0x80,0x00,/*"大",7*/
		
		0x10,0x60,0x02,0x8C,0x00,0x08,0x08,0x08,0x09,0xFA,0x08,0x08,0x08,0x08,0x00,0x00,
		0x04,0x04,0x7E,0x01,0x40,0x40,0x41,0x41,0x41,0x7F,0x41,0x41,0x41,0x41,0x40,0x00,/*"注",8*/
		
		0x10,0x10,0x12,0xD2,0x56,0x5A,0x52,0x53,0x52,0x5A,0x56,0xD2,0x12,0x10,0x10,0x00,
		0x40,0x30,0x00,0x77,0x85,0x85,0x8D,0xB5,0x85,0x85,0x85,0xE7,0x00,0x10,0x60,0x00,/*"意",9*/
		
		0x00,0xFE,0x02,0x22,0xDA,0x06,0x08,0x08,0xF8,0x89,0x8E,0x88,0x88,0x88,0x08,0x00,
		0x00,0xFF,0x08,0x10,0x08,0x87,0x40,0x30,0x0F,0x00,0x40,0x80,0x40,0x3F,0x00,0x00,/*"防",10*/
		
		0x00,0x00,0x00,0x5F,0x55,0x55,0xF5,0x55,0x55,0x55,0x95,0x5F,0x00,0x00,0x00,0x00,
		0x11,0x11,0x09,0x09,0xFD,0x55,0x57,0x57,0x55,0x55,0x55,0xFD,0x01,0x01,0x01,0x00,/*"暑",11*/

		0x00,0x80,0x60,0xF8,0x07,0x00,0x3E,0x22,0x22,0xE2,0x22,0x22,0x3E,0x00,0x00,0x00,
		0x01,0x00,0x00,0xFF,0x20,0x11,0x09,0x05,0x03,0xFF,0x03,0x05,0x09,0x11,0x20,0x00,/*"保",12*/

		0x00,0xFC,0x44,0x44,0xFC,0x02,0x26,0x2A,0xE2,0x26,0x29,0x21,0x29,0x25,0x00,0x00,
		0x00,0x1F,0x08,0x08,0x5F,0x21,0x99,0x87,0x4D,0x55,0x25,0x55,0x4D,0x81,0x81,0x00,/*"暖",13*/

		0x40,0x40,0x42,0xCC,0x00,0x10,0x92,0x92,0x92,0xFF,0x91,0x91,0x91,0x10,0x10,0x00,
		0x00,0x40,0x20,0x1F,0x20,0x40,0x5F,0x48,0x48,0x48,0x48,0x48,0x5F,0x40,0x40,0x00,/*"适",14*/

		0x10,0x0C,0x04,0xE4,0x24,0x24,0x25,0x26,0x24,0x24,0x24,0xE4,0x04,0x14,0x0C,0x00,
		0x40,0x40,0x40,0x7F,0x49,0x49,0x49,0x49,0x49,0x49,0x49,0x7F,0x40,0x40,0x40,0x00,/*"宜",15*/
		
		0x06,0x09,0x09,0xE6,0xF8,0x0C,0x04,0x02,0x02,0x02,0x02,0x02,0x04,0x1E,0x00,0x00,
		0x00,0x00,0x00,0x07,0x1F,0x30,0x20,0x40,0x40,0x40,0x40,0x40,0x20,0x10,0x00,0x00,/*"?",0*/
		
		
};

const unsigned char  ascii_table_8x16[13][16]={

0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x0C, 0x0C,0x00,0x00,0x00,		//-.-
0x00,0x00,0x00,0x80, 0xC0,0x60,0x30,0x00, 0x0C,0x06,0x03,0x01, 0x00,0x00,0x00,0x00,		//-/-
0xF8,0xF8,0x0C,0xC4, 0x0C,0xF8,0xF0,0x00, 0x03,0x07,0x0C,0x08, 0x0C,0x07,0x03,0x00,		//-0-		  	ASCII码：0X30
0x00,0x10,0x18,0xFC, 0xFC,0x00,0x00,0x00, 0x00,0x08,0x08,0x0F, 0x0F,0x08,0x08,0x00,		//-1-
0x08,0x0C,0x84,0xC4, 0x64,0x3C,0x18,0x00, 0x0E,0x0F,0x09,0x08, 0x08,0x0C,0x0C,0x00,		//-2-
0x08,0x0C,0x44,0x44, 0x44,0xFC,0xB8,0x00, 0x04,0x0C,0x08,0x08, 0x08,0x0F,0x07,0x00,		//-3-

0xC0,0xE0,0xB0,0x98, 0xFC,0xFC,0x80,0x00, 0x00,0x00,0x00,0x08, 0x0F,0x0F,0x08,0x00,		//-4-			ASCII码：0X34
0x7C,0x7C,0x44,0x44, 0x44,0xC4,0x84,0x00, 0x04,0x0C,0x08,0x08, 0x08,0x0F,0x07,0x00,		//-5-
0xF0,0xF8,0x4C,0x44, 0x44,0xC0,0x80,0x00, 0x07,0x0F,0x08,0x08, 0x08,0x0F,0x07,0x00,		//-6-
0x0C,0x0C,0x04,0x84, 0xC4,0x7C,0x3C,0x00, 0x00,0x00,0x0F,0x0F, 0x00,0x00,0x00,0x00,		//-7-
0xB8,0xFC,0x44,0x44, 0x44,0xFC,0xB8,0x00, 0x07,0x0F,0x08,0x08, 0x08,0x0F,0x07,0x00,		//-8-
0x38,0x7C,0x44,0x44, 0x44,0xFC,0xF8,0x00, 0x00,0x08,0x08,0x08, 0x0C,0x07,0x03,0x00,		//-9-
0x00,0x00,0x00,0x30, 0x30,0x00,0x00,0x00, 0x00,0x00,0x00,0x06, 0x06,0x00,0x00,0x00,		//-:-
};

void OLED_WriteData(uint8_t data)
{
	IIC_Start();
  IIC_Send_Byte(0x78); 
	IIC_Send_Byte(0x40);
	IIC_Send_Byte(data);

}


void OLED_WriteReg(uint8_t data)
{ 
	IIC_Start();
	IIC_Send_Byte(0x78);
	IIC_Send_Byte(0x00);
	IIC_Send_Byte(data);
}

void OLED_InitReg(void)
{
	
    
	
		OLED_WriteReg(0xae);//--turn off oled panel

    //OLED_WriteReg(0x15);    //   set column address
    //OLED_WriteReg(0x00);    //  start column   0
    //OLED_WriteReg(0x3f);    //  end column   127

    //OLED_WriteReg(0x75);    //   set row address
    //OLED_WriteReg(0x00);    //  start row   0
    //OLED_WriteReg(0x7f);    //  end row   127
	
    OLED_WriteReg(0x81);  // set contrast control
    OLED_WriteReg(0x80);

    OLED_WriteReg(0xa0);    // gment remap
    OLED_WriteReg(0x02);   //51   //?

    OLED_WriteReg(0xa1);  // start line
    OLED_WriteReg(0x00);

    OLED_WriteReg(0xa2);  // display offset
    OLED_WriteReg(0x00);

    OLED_WriteReg(0xa4);    // rmal display
    OLED_WriteReg(0xa8);    // set multiplex ratio
    OLED_WriteReg(0x7f);

    OLED_WriteReg(0xb1);  // set phase leghth
    OLED_WriteReg(0xf1);

    OLED_WriteReg(0xb3);  // set dclk
    OLED_WriteReg(0x00);  //80Hz:0xc1 90Hz:0xe1   100Hz:0x00   110Hz:0x30 120Hz:0x50   130Hz:0x70     01

    OLED_WriteReg(0xab);  //
    OLED_WriteReg(0x01);  //

    OLED_WriteReg(0xb6);  // set phase leghth
    OLED_WriteReg(0x07);

    OLED_WriteReg(0xbe);
    OLED_WriteReg(0x07);

    OLED_WriteReg(0xbc);
    OLED_WriteReg(0x08);

    OLED_WriteReg(0xd5);
    OLED_WriteReg(0x62);
		
		OLED_WriteReg(0x2e); 
		
		OLED_WriteReg(0xfd);
    OLED_WriteReg(0x12);
   
    OLED_WriteReg(0xaf);

}

void OLED_SetCursor(uint16_t Xpoint, uint16_t Ypoint )
{
	OLED_WriteReg(0X15);
	OLED_WriteReg(Xpoint);
	OLED_WriteReg(Xpoint);
	
	OLED_WriteReg(0X75);
	OLED_WriteReg(Ypoint);
	OLED_WriteReg(Ypoint+7);
}

void OLED_SetContrast(uint16_t arr)
{
    OLED_WriteReg(0x81);  // set contrast control
    OLED_WriteReg(arr);
}

void transfer_col_data(unsigned char data1,unsigned char data2)
 
{
  unsigned char i; 
	 	for(i=0;i<8;i++)
	{
          if ((data1& 0x01)&&(data2& 0x01))	
		    { 	
	      OLED_WriteData(0xFF);            


			  }
        else  if  ((data1& 0x01)==1&&(data2& 0x01)==0)				
		    {
			       
              OLED_WriteData(0xF0);   
        }
        else  if  ((data1& 0x01)==0&&(data2& 0x01)==1)				
		    {
			       
              OLED_WriteData(0x0F);   
        }
        else  if  ((data1& 0x01)==0&&(data2& 0x01)==0)				
		    {
			       
              OLED_WriteData(0x00);   
        }
 
        data1>>= 1;
        data2>>= 1;
    }
  
}

void transfer_col_data2(unsigned char data1,unsigned char data2,unsigned char gray_value)
{
  unsigned char i; 
	 	for(i=0;i<8;i++)
	{
          if ((data1& 0x01)&&(data2& 0x01))	
		    { 	
	     OLED_WriteData((gray_value<<4)|gray_value);              

			  }
        else  if  ((data1& 0x01)==1&&(data2& 0x01)==0)				
		    {
			       
              OLED_WriteData((gray_value<<4)&0xF0);   
        }
        else  if  ((data1& 0x01)==0&&(data2& 0x01)==1)				
		    {
			       
              OLED_WriteData((gray_value)&0x0F);   
        }
        else  if  ((data1& 0x01)==0&&(data2& 0x01)==0)				
		    {
			       
              OLED_WriteData(0x00);   
        }
 
        data1>>= 1;
        data2>>= 1;
    } 
}

void display_string_8x16(uint8_t row,uint8_t column,uint8_t *text)
{
	uint16_t i=0,j,k,n,x,y;
	if(column>63)
	{
		column=0;

	}
	while(text[i]>0x00)
	{	
		if((text[i]>=0x20)&&(text[i]<=0x7e))
		{
			j=text[i]-0x2e;
			for(n=0;n<2;n++)
			{			
				for(k=0;k<4;k++)   
				{					
					OLED_SetCursor(column+k,n*8+row);
					delay_us(1);
					x = ascii_table_8x16[j][2*k+8*n];
					y = ascii_table_8x16[j][2*k+1+8*n];
				  transfer_col_data(x,y);
					delay_us(1);
				}
			}
			i++;
			column+=4; //?
		}
		else
		i++;
	}
}

void display_string_16x16(uint8_t row,uint8_t column,uint8_t *text)
{
    uint8_t i,j,k;
    uint32_t address; 
    
    j = 0;
    while(text[j] != '\0')
    {
        i = 0;
        address = 1;
        while(Chinese_text_16x16[i] > 0x7e)	
        {
            if(Chinese_text_16x16[i] == text[j])
            {
                if(Chinese_text_16x16[i + 1] == text[j + 1])
                {
                    address = i * 16;
                    break;
                }
            }
            i += 2;            
        }
        
        if(column >63)
        {
            column = 0;

        }
        
        if(address != 1)                  
        {
            
						for(k=0;k<2;k++)
						{
						
										for(i = 0; i < 8; i++)               
										{
									
                        OLED_SetCursor(column+i,k*8+row);
												delay_us(1);
                        transfer_col_data(Chinese_code_16x16[address],Chinese_code_16x16[address+1]); 
												delay_us(1);
											  address+=2;
											
										}
										
						}
									j += 2;        
        }
        else                  
        {
						for(k=0;k<2;k++)
						{
						
										for(i = 0; i < 8; i++)           
										{
											OLED_SetCursor(column+i,k*8+row);
									    transfer_col_data(0x00,0x00);										
										}
						}
									
									j++;
        }
        
        column+=7;
    }
}


void disp_string_8x16_16x16(uint8_t row,uint8_t column,uint8_t *text)
{
    uint8_t temp[3];
    uint8_t i = 0;    
    
    while(text[i] != '\0')
    {
        if(text[i] > 0x7e)
        {
            temp[0] = text[i];
            temp[1] = text[i + 1];
            temp[2] = '\0';         
            display_string_16x16(row,column,temp); 
            column += 8;
            i += 2;
        }
        else
        {
            temp[0] = text[i];    
            temp[1] = '\0';          
            display_string_8x16(row, column, temp);  
            column += 4;             
            i++;
        }
    }
}
void disp(uint8_t row,uint8_t column)
{ 
	uint8_t i,k;
  uint32_t address = 512; 
	for(k=0;k<2;k++)
						{
						
										for(i = 0; i < 8; i++)               
										{
									
                        OLED_SetCursor(column+i,k*8+row);										
                        transfer_col_data(Chinese_code_16x16[address],Chinese_code_16x16[address+1]);											
											  address+=2;
											
										}
										
						}
}


void clear_screen()
{
  int i,j;
  OLED_WriteReg(0x15);
  OLED_WriteReg(0x00);
  OLED_WriteReg(0x3f);

  OLED_WriteReg(0x75);
  OLED_WriteReg(0x00);
  OLED_WriteReg(0x7f);

 for(i=0;i<128;i++) 
  {
    for(j=0;j<64;j++)
     {
      OLED_WriteData(0x00);//RAM data write
     }
  }
}



void put1(double temp)
{
	uint32_t i,j,k; 
	unsigned char number[6];
	k = ((int )(temp*10))%10 + 0X30;
	i = ((int )temp)/10 + 0x30;
	j = ((int )temp)%10 + 0x30;
	
	
  number[0] = ':';
	delay_us(1);
  number[1] = i;
	delay_us(1);
  number[2] = j;
	delay_us(1);
  number[3] = '.';
	delay_us(1);
  number[4] = k;
	delay_us(1);
	number[5] = '\0';
	delay_us(1);
	disp_string_8x16_16x16(0,0,"室内温度");
	delay_ms(1);
	display_string_8x16(0,33,number);
	delay_ms(1);
	disp(0,55);

}

void put2(double temp)
{
	uint32_t i,j,k; 
	unsigned char number[6];
	i = ((int )temp)/10 + 0x30;
	j = ((int )temp)%10 + 0x30;
	k = ((int )(temp*10))%10 + 0X30;
	
  number[0] = ':';
	delay_us(1);
  number[1] = i;
	delay_us(1);
  number[2] = j;
	delay_us(1);
  number[3] = '.';
	delay_us(1);
  number[4] = k;
	delay_us(1);
	number[5] = '\0';
	delay_us(1);
	disp_string_8x16_16x16(16,0,"室外温度");
	delay_ms(1);
	display_string_8x16(16,33,number);
	delay_ms(1);
	disp(16,55);
	
}

void put3()
{
	disp_string_8x16_16x16(32,0,"室内外温差较大");
	
}

void put4()
{
	disp_string_8x16_16x16(32,0,"室内外温差适宜");
	
}

void put5()
{
	disp_string_8x16_16x16(48,0,"注意保暖");
	
}

void put6()
{
	disp_string_8x16_16x16(48,0,"注意防暑");
	
}








